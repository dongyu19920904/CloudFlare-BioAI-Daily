# 代码修改说明

## ✅ 修改完成

**修改文件**: `src/contentUtils.js`  
**修改函数**: `computeMonthDirectoryWeight(yearMonth)`

---

## 📝 修改内容

### 修改前（递增公式，错误）
```javascript
// 递增公式：新月份权重更大，会排在前面
return 100000 + (year - 2000) * 12 + month;
```

**问题**:
- 2025-12: weight = 100312
- 2026-01: weight = 100313（更大）
- Hugo 升序排序时，2025-12 排在 2026-01 前面 ❌

### 修改后（递减公式，正确）
```javascript
// 递减公式：新月份权重更小，在升序排序时会排在前面
const baseWeight = 1000000;
const yearWeight = (year - 2000) * 12;
const monthWeight = month;
return baseWeight - yearWeight - monthWeight;
```

**效果**:
- 2025-06: weight = 999694
- 2025-12: weight = 999688
- 2026-01: weight = 999687（最小，排在最前）✅

---

## 🧪 验证方法

### 1. 手动验证权重计算

在 Node.js 环境中测试：

```javascript
// 测试函数
function computeMonthDirectoryWeight(yearMonth) {
    if (!yearMonth || typeof yearMonth !== 'string') return 0;
    const parts = yearMonth.split('-');
    if (parts.length !== 2) return 0;
    const year = Number.parseInt(parts[0], 10);
    const month = Number.parseInt(parts[1], 10);
    if (!Number.isFinite(year) || !Number.isFinite(month)) return 0;
    
    const baseWeight = 1000000;
    const yearWeight = (year - 2000) * 12;
    const monthWeight = month;
    return baseWeight - yearWeight - monthWeight;
}

// 测试用例
console.log('2025-06:', computeMonthDirectoryWeight('2025-06')); // 999694
console.log('2025-12:', computeMonthDirectoryWeight('2025-12')); // 999688
console.log('2026-01:', computeMonthDirectoryWeight('2026-01')); // 999687

// 验证排序
const months = [
    { month: '2025-06', weight: computeMonthDirectoryWeight('2025-06') },
    { month: '2025-12', weight: computeMonthDirectoryWeight('2025-12') },
    { month: '2026-01', weight: computeMonthDirectoryWeight('2026-01') }
];
months.sort((a, b) => a.weight - b.weight); // 升序排序
console.log('排序结果:', months.map(m => m.month));
// 应该输出: ['2026-01', '2025-12', '2025-06']
```

### 2. 部署后验证

1. **部署修改后的代码**到 Cloudflare Workers
2. **触发一次日报生成**（手动或等待自动触发）
3. **检查生成的 `_index.md` 文件**：
   - 查看 `content/cn/2026-01/_index.md`
   - 确认 `weight: 999687`
4. **检查前端网页**：
   - 打开网站侧边栏
   - 确认 2026-01 排在最上面 ✅

### 3. 批量更新已存在的月份目录（可选）

如果需要立即修复所有已存在的月份目录，可以：

1. **手动触发更新**：
   - 访问 `/triggerScheduled?date=2026-01-02` 端点
   - 会自动更新 `content/cn/2026-01/_index.md`

2. **或者等待自动更新**：
   - 下次生成新日报时，会自动更新对应月份的 `_index.md`

---

## 📊 权重计算示例

| 年月 | 年份权重 | 月份权重 | 计算结果 | 排序位置 |
|------|---------|---------|---------|---------|
| 2026-01 | 312 | 1 | 999687 | 1️⃣ 最前 |
| 2025-12 | 300 | 12 | 999688 | 2️⃣ |
| 2025-11 | 300 | 11 | 999689 | 3️⃣ |
| 2025-06 | 300 | 6 | 999694 | 最后 |

**公式**: `weight = 1000000 - (year - 2000) * 12 - month`

---

## ⚠️ 注意事项

1. **已存在的月份目录**：
   - 已生成的 `_index.md` 文件仍使用旧权重
   - 需要重新生成才能使用新权重
   - 可以通过手动触发或等待自动更新

2. **未来兼容性**：
   - 基础值 `1000000` 足够大，可以支持到 2083 年
   - 如果需要支持更远的年份，可以增加基础值

3. **其他排序逻辑**：
   - 此修改只影响月份目录的排序
   - 不影响日报文章内部的排序（使用 `computeWeight` 函数）

---

## ✅ 修改完成检查清单

- [x] 修改 `computeMonthDirectoryWeight` 函数
- [x] 更新函数注释
- [x] 更新代码注释
- [x] 验证无 lint 错误
- [ ] 部署到 Cloudflare Workers
- [ ] 验证前端显示效果

---

**修改时间**: 2026-01-02  
**修改人**: AI Assistant

